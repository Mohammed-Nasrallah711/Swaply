import{i as A,d as i,y as k,q as S,o as y,w as b,a1 as F,j as f,a as l,n as O,a6 as L,aM as q,aU as z,t as E,W as V,a0 as I,p as Q,g as W,c as C,F as N,a4 as M,aa as H,ab as J,b as j}from"./index-BlBeKsLJ.js";import{_ as K}from"./HeaderPage-DlbyCt4A.js";import{_ as P}from"./MainDialog-BH8k8M0B.js";import{G as R,r as X,a as Y}from"./GenericDataTable-DdiJ_m3T.js";const Z={__name:"AddOrEditCategoryDialog",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},category:{type:[Object,String],default:{}}},emits:["update:modelValue","update:category","fetchCategories"],setup($,{emit:D}){const t=$,s=D,u=A("emitter"),c=i(!1),d=i({}),{cleanId:_}=I(),w=k({get:()=>t.modelValue,set:o=>s("update:modelValue",o)}),n=k({get:()=>t.category?typeof t.category=="string"?t.category:t.category.name??"":"",set:o=>{typeof t.category=="string"||!t.category?s("update:category",o):s("update:category",{...t.category,name:o})}}),g=k(()=>t.mode),m=()=>{d.value={},s("update:modelValue",!1)},x=k(()=>{let o=g.value==="create"?"إضافة":"تعديل";return c.value?o+"...":o}),p=async()=>{try{c.value=!0,g.value==="create"?(await V.post("/admin/categories",{name:n.value})).status==200&&(m(),u.emit("showNotificationAlert",["success",`تم اضافة التصنيف ${n.value} بنجاح!`]),s("fetchCategories")):t.category.id&&(await V.put(`/admin/categories/${_(t.category.id)}`,{name:n.value})).status==200&&(m(),u.emit("showNotificationAlert",["success",`تم تحديث التصنيف ${n.value} بنجاح!`]),s("fetchCategories"))}catch(o){d.value=o.response?.data?.errors||{}}finally{c.value=!1}};return(o,v)=>(y(),S(P,{modelValue:w.value,"onUpdate:modelValue":v[1]||(v[1]=h=>w.value=h),"button-label":x.value,loading:c.value,onSubmitData:p},{title:b(()=>[z(E($.mode==="create"?"إضافة تصنيف جديد":"تعديل التصنيف"),1)]),content:b(()=>[F(l("input",{"onUpdate:modelValue":v[0]||(v[0]=h=>n.value=h),type:"text",placeholder:"اسم التصنيف",class:O(["w-full rounded-lg px-3 py-2 outline-none transition-all duration-200",{"border border-gray-300 focus:border-blue-400 focus:ring-2 focus:ring-blue-400":!d.value.name?.[0],"border border-red-500 focus:border-red-500 focus:ring-2 focus:ring-red-500":d.value.name?.[0]}])},null,2),[[L,n.value]]),f(q,{"error-message":d.value.name?.[0]},null,8,["error-message"])]),_:1},8,["modelValue","button-label","loading"]))}},ee={class:"mb-4"},ae={key:0,class:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 transition-colors duration-200"},te={class:"space-y-4"},oe={class:"grid grid-cols-4 gap-4 pb-4 border-b border-gray-200 dark:border-gray-700"},re={class:"flex gap-2 justify-center"},se=["onClick"],le=["onClick"],ce={__name:"CategoryView",setup($){const D=[{text:"رقم التصنيف",value:"id",sortable:!0},{text:"اسم التصنيف",value:"name",sortable:!0},{text:"تاريخ الإضافة",value:"created_at",sortable:!0},{text:"إجراءات",value:"actions"}],t=i([]),s=i(""),u=i(!0),c=k(()=>s.value?t.value.filter(r=>r.name.toLowerCase().includes(s.value.toLowerCase())):t.value),{formatDate:d,cleanId:_}=I(),w=i("create"),n=i({}),g=i(!1),m=i(!1),x=i(""),p=Q({}),o=A("emitter"),v=({id:r,name:e=""})=>{x.value=`هل أنت متأكد من رغبتك بحذف التصنيف "${e}"؟`,p.name=e,p.id=r,m.value=!0},h=async()=>{(await V.delete(`admin/categories/${_(p.id)}`)).status==200&&(t.value=t.value.filter(e=>e.id!==p.id),o.emit("showNotificationAlert",["success","تم حذف التصنيف بنجاح!"]))},B=(r,e={})=>{w.value=r,n.value=e,g.value=!0},T=r=>{const e=t.value.filter(a=>a.id==_(r.id))[0];B("edit",e)},U=async()=>{u.value=!0;try{const r=await V.get("/admin/categories");t.value=r.data.categories.map(e=>({id:e.id,name:e.name,description:e.description,created_at:d(e.created_at)}))}catch{}finally{u.value=!1}};return W(async()=>{await U()}),(r,e)=>(y(),C(N,null,[f(K,{title:"التصنيفات",ButtonLabel:"اضافة تصنيف جديد",onButtonAddClick:e[0]||(e[0]=a=>B("create"))}),l("div",ee,[F(l("input",{name:"category-search","onUpdate:modelValue":e[1]||(e[1]=a=>s.value=a),type:"text",placeholder:"ابحث عن تصنيف...",class:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 outline-none dark:bg-gray-700 dark:border-gray-600 dark:text-white placeholder:text-gray-600/60 dark:placeholder-gray-400"},null,512),[[L,s.value]])]),u.value?(y(),C("div",ae,[l("div",te,[l("div",oe,[(y(),C(N,null,M(4,a=>l("div",{key:a,class:"h-5 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"})),64))]),(y(),C(N,null,M(8,a=>l("div",{key:a,class:"grid grid-cols-4 gap-4 py-4 border-b border-gray-200 dark:border-gray-700"},[...e[5]||(e[5]=[J('<div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="flex gap-2 justify-center"><div class="h-8 w-16 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-8 w-16 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div></div>',4)])])),64))])])):(y(),S(R,{key:1,headers:D,items:c.value},{id:b(({item:a})=>[l("span",null,"# "+E(a.id),1)]),actions:b(a=>[l("div",re,[l("button",{onClick:G=>T(a.item),class:"bg-blue-600 text-white px-3 py-1 rounded"}," تعديل ",8,se),l("button",{onClick:G=>v(a.item),class:"bg-red-600 text-white px-3 py-1 rounded"}," حذف ",8,le)])]),"prev-icon":b(()=>[f(j(Y),{class:"w-5"})]),"next-icon":b(()=>[f(j(X),{class:"w-5"})]),_:1},8,["items"])),f(Z,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=a=>g.value=a),mode:w.value,category:n.value,"onUpdate:category":e[3]||(e[3]=a=>n.value=a),onFetchCategories:U},null,8,["modelValue","mode","category"]),f(H,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=a=>m.value=a),message:x.value,onConfirm:h},null,8,["modelValue","message"])],64))}};export{ce as default};
