import{_ as A}from"./HeaderPage-DlbyCt4A.js";import{G,r as T,a as q}from"./GenericDataTable-DdiJ_m3T.js";import{_ as L}from"./MainDialog-BH8k8M0B.js";import{d as o,i as I,y as w,q as F,o as p,w as V,j as v,aU as W,W as D,p as z,g as H,c as k,a as m,F as $,a4 as N,aa as J,a0 as K,ab as P,b as j}from"./index-BlBeKsLJ.js";import{_ as B}from"./SelectListBox-C5TQ5uG5.js";import"./listbox-C2KpOBbF.js";const Q={__name:"EditUserDialog",props:{modelValue:{type:Boolean,default:!1},user:{type:Object,default:()=>({})},userRole:{type:String,default:""},userStatus:{type:String,default:""}},emits:["update:modelValue","update:userRole","update:userStatus","fetchUsers"],setup(R,{emit:_}){const n=R,d=_,b=[{id:1,name:"تاجر",val:"merchant"},{id:2,name:"مستهلك",val:"customer"}],g=[{id:1,name:"معلق",val:"pending"},{id:2,name:"نشط",val:"active"},{id:2,name:"غير نشط",val:"inactive"}],r=o(!1),x=I("emitter"),f=w({get:()=>n.modelValue,set:t=>d("update:modelValue",t)}),U=()=>d("update:modelValue",!1),u=w(()=>r.value?"تعديل...":"تعديل"),i=w({get:()=>b.find(t=>t.val===n.userRole)||null,set:t=>d("update:userRole",t?.val||"")}),y=w({get:()=>g.find(t=>t.val===n.userStatus)||nulls,set:t=>d("update:userStatus",t?.val||"")}),S=async()=>{try{r.value=!0,(await D.put(`/admin/users/${n.user.id}`,{role:i.value.val,status:y.value.val})).status==200&&(x.emit("showNotificationAlert",["success",`تم تحديث بيانات المستخدم ${n.user?.name} بنجاح!`]),d("fetchUsers")),U()}catch{}finally{r.value=!1}},h=()=>S();return(t,l)=>(p(),F(L,{modelValue:f.value,"onUpdate:modelValue":l[2]||(l[2]=c=>f.value=c),"button-label":u.value,onSubmitData:h,loading:r.value},{title:V(()=>[...l[3]||(l[3]=[W(" تعديل بيانات المستخدم ",-1)])]),content:V(()=>[v(B,{label:"اختر دور المستخدم",modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=c=>i.value=c),options:b,class:"w-full"},null,8,["modelValue"]),v(B,{label:"اختر حالة المستخدم",modelValue:y.value,"onUpdate:modelValue":l[1]||(l[1]=c=>y.value=c),options:g,class:"w-full mt-4"},null,8,["modelValue"])]),_:1},8,["modelValue","button-label","loading"]))}},X={key:0,class:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 transition-colors duration-200"},Y={class:"space-y-4"},Z={class:"grid grid-cols-7 gap-4 pb-4 border-b border-gray-200 dark:border-gray-700"},ee={class:"flex gap-2 justify-center"},ae=["onClick"],te=["onClick"],de={__name:"UserView",setup(R){const _=[{text:"رقم المستخدم",value:"id",sortable:!0},{text:"اسم المستخدم",value:"name",sortable:!0},{text:"البريد الإلكتروني",value:"email",sortable:!0},{text:"رقم الهاتف",value:"phone",sortable:!0},{text:"الدور",value:"role",sortable:!0},{text:"الحالة",value:"status",sortable:!0},{text:"إجراءات",value:"actions"}],n=s=>{switch(s){case"admin":return"مدير";case"merchant":return"تاجر";case"customer":return"مستهلك";default:return"غير معروف"}},d=s=>{switch(s){case"active":return"نشط";case"inactive":return"غير نشط";case"pending":return"معلق";default:return"غير معروف"}},b=o([]),g=o(!0),r=o({}),{formatDate:x,cleanId:f}=K(),U=o("create"),u=o({}),i=o(!1),y=(s,e={})=>{U.value=s,u.value=e,i.value=!0},S=s=>{const e=r.value.filter(a=>a.id==f(s.id))[0];y("edit",e)},h=o(!1),t=o(""),l=z({}),c=I("emitter"),E=({id:s,name:e=""})=>{t.value=`هل أنت متأكد من رغبتك بحذف المستخدم "${e}"؟`,l.username=e,l.userId=s,h.value=!0},M=async()=>{(await D.delete(`admin/users/${f(l.userId)}`)).status==200&&(r.value=r.value.filter(e=>e.userId!==l.userId),c.emit("showNotificationAlert",["success","تم حذف المستخدم بنجاح!"]))},C=async()=>{g.value=!0;try{await D.get("/admin/users").then(s=>{r.value=s.data.data,b.value=s.data.data.map(e=>({id:`# ${e.id}`,name:e.name,email:e.email??"غير مسجل",phone:e.phone?`⁦${e.phone}⁩`:"غير مسجل",role:n(e.role),status:d(e.status),created_at:x(e.created_at)}))})}catch{}finally{g.value=!1}};return H(async()=>{await C()}),(s,e)=>(p(),k($,null,[v(A,{title:"المستخدمون","is-has-add-button":!1}),g.value?(p(),k("div",X,[m("div",Y,[m("div",Z,[(p(),k($,null,N(7,a=>m("div",{key:a,class:"h-5 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"})),64))]),(p(),k($,null,N(8,a=>m("div",{key:a,class:"grid grid-cols-7 gap-4 py-4 border-b border-gray-200 dark:border-gray-700"},[...e[4]||(e[4]=[P('<div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="flex gap-2 justify-center"><div class="h-8 w-16 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-8 w-16 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div></div>',7)])])),64))])])):(p(),F(G,{key:1,headers:_,items:b.value},{actions:V(a=>[m("div",ee,[m("button",{onClick:O=>S(a.item),class:"bg-blue-600 text-white px-3 py-1 rounded"}," تعديل ",8,ae),m("button",{onClick:O=>E(a.item),class:"bg-red-600 text-white px-3 py-1 rounded"}," حذف ",8,te)])]),"prev-icon":V(()=>[v(j(q),{class:"w-5"})]),"next-icon":V(()=>[v(j(T),{class:"w-5"})]),_:1},8,["items"])),v(Q,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=a=>i.value=a),userRole:u.value.role,"onUpdate:userRole":e[1]||(e[1]=a=>u.value.role=a),user:u.value,userStatus:u.value.status,"onUpdate:userStatus":e[2]||(e[2]=a=>u.value.status=a),onFetchUsers:C},null,8,["modelValue","userRole","user","userStatus"]),v(J,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=a=>h.value=a),message:t.value,onConfirm:M},null,8,["modelValue","message"])],64))}};export{de as default};
