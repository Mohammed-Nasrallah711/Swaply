import{_ as C}from"./HeaderPage-DlbyCt4A.js";import{G as N,r as $,a as A}from"./GenericDataTable-DdiJ_m3T.js";import{d as u,y as j,g as B,c as d,o as s,j as l,q as R,a as o,F as p,a4 as b,w as n,W as g,i as V,ab as F,b as y,t as L,a0 as D}from"./index-BlBeKsLJ.js";const G={key:0,class:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 transition-colors duration-200"},I={class:"space-y-4"},M={class:"grid grid-cols-6 gap-4 pb-4 border-b border-gray-200 dark:border-gray-700"},S={class:"flex justify-center gap-2"},q=["onClick"],E={key:1,class:"px-3 py-1 rounded bg-green-600 text-white cursor-default"},Q=["onClick"],J={__name:"ReportView",setup(T){const _=[{text:"رقم المنتج",value:"product_id",sortable:!0},{text:"اسم المنتج",value:"product_name",sortable:!0},{text:"سعر المنتج",value:"product_price",sortable:!0},{text:"صاحب المنتج",value:"owner_name",sortable:!0},{text:"عدد مرات الإبلاغ",value:"report_count",sortable:!0},{text:"إجراءات",value:"actions"}],a=u([]),v=u(""),c=u(!0),i=V("emitter"),{cleanId:m}=D(),h=j(()=>v.value?a.value.filter(r=>r.owner_name.toLowerCase().includes(v.value.toLowerCase())):a.value),f=async()=>{c.value=!0;try{const r=await g.get("/admin/reports");a.value=r.data.data.map(t=>({id:t.id,product_id:t.product_id,owner_name:t.product.store.user.name,product_price:`${Math.round(t.product.price)}`,report_count:t.report_count,product_name:t.product.name,status:t.status}))}catch{}finally{c.value=!1}},k=async r=>{try{(await g.put(`/admin/products/${m(r.product_id)}/report/make-reviewed`,{status:"reviewed"})).status===200&&(a.value=a.value.map(e=>e.id===r.id?{...e,status:"reviewed"}:e),i.emit("showNotificationAlert",["success","تمت مراجعة البلاغ"]))}catch{i.emit("showNotificationAlert",["error","فشلت عملية المراجعة"])}},w=async r=>{if(confirm("هل أنت متأكد من حذف هذا البلاغ؟"))try{(await g.delete(`/admin/products/${m(r.product_id)}/report`)).status===200&&(a.value=a.value.filter(e=>e.id!==r.id),i.emit("showNotificationAlert",["success","تم حذف البلاغ بنجاح"]))}catch{i.emit("showNotificationAlert",["error","فشلت عملية الحذف"])}};return B(async()=>{await f()}),(r,t)=>(s(),d(p,null,[l(C,{title:"البلاغات","is-has-add-button":!1}),c.value?(s(),d("div",G,[o("div",I,[o("div",M,[(s(),d(p,null,b(6,e=>o("div",{key:e,class:"h-5 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"})),64))]),(s(),d(p,null,b(8,e=>o("div",{key:e,class:"grid grid-cols-6 gap-4 py-4 border-b border-gray-200 dark:border-gray-700"},[...t[0]||(t[0]=[F('<div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="flex gap-2 justify-center"><div class="h-8 w-24 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div></div>',6)])])),64))])])):(s(),R(N,{key:1,headers:_,items:h.value},{product_id:n(({item:e})=>[o("span",null,"#"+L(e.product_id),1)]),actions:n(e=>[o("div",S,[e.item.status!=="reviewed"?(s(),d("button",{key:0,onClick:x=>k(e.item),class:"text-blue-600 dark:text-slate-50 hover:underline px-2 py-1 rounded hover:bg-blue-50 dark:hover:bg-blue-900/20"}," مراجعة البلاغ ",8,q)):(s(),d("span",E," تمت المراجعة ")),o("button",{onClick:x=>w(e.item),class:"text-red-600 dark:text-red-400 hover:underline px-2 py-1 rounded hover:bg-red-50 dark:hover:bg-red-900/20"}," حذف ",8,Q)])]),"prev-icon":n(()=>[l(y(A),{class:"w-5"})]),"next-icon":n(()=>[l(y($),{class:"w-5"})]),_:1},8,["items"]))],64))}};export{J as default};
