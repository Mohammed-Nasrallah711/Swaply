import{aF as F,d as I,y as c,aG as T,ap as B,g as w,c as g,o as u,a as t,l as k,t as o,j as h,b as d,a0 as P,aH as R,n as V,aI as E,ac as $,L as j,s as L,F as M,a4 as O,e as U,q}from"./index-BlBeKsLJ.js";import{r as z}from"./CheckIcon-enk7v0_e.js";import{u as A}from"./search-lPjCMzJb.js";const D={class:"flex flex-col-reverse lg:grid lg:grid-cols-3 border border-gray-200 dark:border-gray-700 rounded-xl mt-3 gap-6 overflow-hidden bg-white dark:bg-gray-900"},H={class:"py-8 px-6 rounded-xl mb-2"},Y={class:"flex justify-between items-center font-normal text-[22px] xl:text-[26px]"},G={class:"flex gap-2 items-center font-normal text-[22px] xl:text-[26px]"},J={class:"flex flex-col"},K={class:"text-gray-900 dark:text-gray-100"},Q={key:0,class:"text-[12px] text-gray-500 dark:text-gray-400 leading-tight mt-1"},W={key:0,class:"cursor-default border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 gap-[2px] text-[10px] py-1 pr-1 flex items-center"},X={class:"text-gray-900 dark:text-gray-100 font-semibold"},Z={class:"flex items-center justify-between text-gray-700 dark:text-gray-300 font-normal"},ee={class:"flex items-center gap-2 mt-3"},te={class:"flex justify-between flex-col items-start gap-2 mt-3"},re={class:"flex items-center gap-1 text-gray-500 dark:text-gray-400 font-normal"},ae={class:"text-gray-500 dark:text-gray-400 text-[12px] mt-3 font-normal"},se={class:"col-span-2 bg-gray-100 dark:bg-gray-800"},oe={class:"p-0"},ne=["src","alt"],ce={__name:"SingleStoreBox",props:{storeName:String,isCertified:Boolean,price:[Number,String],rating:[Number,String],cityId:Number,lastUpdate:String,image:String,recentPrices:Array,priceRating:String,productName:String,isCategorySearch:Boolean},setup(r){const s=r,{currencyFormat:p}=P(),{calculatePriceRating:_}=T(),m=F(),x=I(0),f=c(()=>Number(s.price)),S=c(()=>{const a=Number(s.rating);return isNaN(a)?4:a}),y=c(()=>S.value.toFixed(1)),i=c(()=>_(f.value,s.recentPrices,s.priceRating)),v=B(),b=c(()=>v.distanceToSpecificCity(s.cityId)),n=c(()=>!!s.isCategorySearch||!!s.productName);return w(async()=>{x.value=await m.convertToUSD(f.value)}),(a,e)=>(u(),g("div",D,[t("div",H,[t("div",Y,[t("div",G,[t("div",J,[t("span",K,o(n.value?r.productName:r.storeName),1),n.value?(u(),g("span",Q,o(r.storeName),1)):k("",!0)]),r.isCertified?(u(),g("span",W,[e[0]||(e[0]=t("span",{class:"font-medium"},"معتمد",-1)),h(d(z),{class:"w-4 h-4"})])):k("",!0)]),t("span",X,o(d(p)(r.price,void 0,"ar","ILS")),1)]),t("div",Z,[t("span",ee,[t("span",null,o(y.value),1),h(d(R),{class:"w-5 h-5 text-amber-400"})]),t("span",null,o(x.value),1)]),t("div",te,[t("span",{class:V(["text-[12px] rounded-lg px-4 py-[6px] cursor-default",i.value.style])},o(i.value.rating),3),t("div",null,[e[1]||(e[1]=t("span",{class:"font-normal text-gray-700 dark:text-gray-200 block mb-1 text-[18px]"},"المسافة",-1)),t("div",re,[t("span",null,o(b.value)+" كم ",1),t("span",null,[h($,{icon:d(E),class:"text-gray-600 dark:text-gray-300"},null,8,["icon"])])])])]),t("div",ae,[e[2]||(e[2]=t("span",null,"اخر تحديث: ",-1)),t("span",null,o(r.lastUpdate),1)])]),t("div",se,[t("div",oe,[t("img",{src:r.image,alt:r.storeName+" صورة",class:"max-h-80 w-full object-cover"},null,8,ne)])])]))}},ie={class:"sm:grid gap-2 sm:grid-cols-2 lg:block pb-6"},le={__name:"ListStoreView",setup(r){const{timeAgo:s}=P(),p=A(),{stores:_,current_page:m,last_page:x,loading:f,errors:S}=L(p),y=U(),i=I(null),v=c(()=>{const n=e=>{if(e==null)return Number.POSITIVE_INFINITY;if(typeof e=="number")return e;const C=String(e).replace(/[^\d.]+/g,""),N=Number.parseFloat(C);return Number.isFinite(N)?N:Number.POSITIVE_INFINITY},a=[];return(_.value||[]).forEach(e=>{(e.products||[]).forEach(l=>{a.push({store:e,product:l,key:`${e.id}-${l.id}`,numericPrice:n(l?.price)})})}),a.sort((e,l)=>e.numericPrice-l.numericPrice),a}),b=async()=>{m.value>=x.value||f.value||await p.fetchAllStoresHasProdcut(y.query.id,m.value+1,{})};return w(()=>{const n=new IntersectionObserver(a=>{a.forEach(e=>{e.isIntersecting&&b()})},{root:null,rootMargin:"0px",threshold:1});i.value&&n.observe(i.value)}),(n,a)=>(u(),g("div",ie,[(u(!0),g(M,null,O(v.value,e=>(u(),q(ce,{key:e.key,price:e.product.price,"store-name":e.store.name,"last-update":d(s)(e.product.updated_at),"is-certified":!0,rating:e.store.rating||0,"city-id":+e.store.city_id,"recent-prices":e.product.recent_prices,image:e.store.image,"price-rating":e.store.price_rating,"product-name":e.product.name,"product-category":e.product.category?.name,"is-category-search":d(y).query.type==="category"},null,8,["price","store-name","last-update","rating","city-id","recent-prices","image","price-rating","product-name","product-category","is-category-search"]))),128)),t("div",{ref_key:"loadMoreTrigger",ref:i,class:"w-full h-1"},null,512)]))}},pe=j(le,[["__scopeId","data-v-ee8d2142"]]);export{pe as default};
