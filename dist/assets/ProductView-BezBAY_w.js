import{d as n,i as I,y as w,aC as q,s as Q,M as R,g as L,q as T,o as x,w as k,a1 as S,a as s,j as h,a6 as A,aT as W,b as M,aU as z,t as E,W as P,p as H,c as D,F as B,a4 as F,aa as J,a0 as K,ab as X}from"./index-BlBeKsLJ.js";import{_ as Y}from"./HeaderPage-DlbyCt4A.js";import{G as Z,r as ee,a as te}from"./GenericDataTable-DdiJ_m3T.js";import{_ as ae}from"./MainDialog-BH8k8M0B.js";const oe={class:"relative w-full"},re={__name:"AddOrEditProductDialog",props:{modelValue:{type:Boolean,default:!1},mode:{type:String,default:"create"},product:{type:Object,default:()=>({})}},emits:["update:modelValue","update:product","fetchProducts"],setup(m,{emit:N}){const r=m,u=N,g=n(!1),i=I("emitter"),v=w({get:()=>r.modelValue,set:a=>u("update:modelValue",a)}),V=w({get:()=>r.product?.name||"",set:a=>u("update:productName",a)}),y=q(),{categories:b}=Q(y),C=w({get:()=>r.product?.category?r.categories.find(a=>a.id===r.product.categoryId):null}),p=n(C.value),c=w(()=>r.mode),U=()=>u("update:modelValue",!1),_=w(()=>{let a=c.value==="create"?"إضافة":"تعديل";return g.value?a+"...":a});R(()=>r.modelValue,a=>{const o=r.product?.category_id;a&&o&&(p.value=b.value.filter(d=>d.id==o)[0])});const $=async()=>{try{g.value=!0,c.value==="create"?(await P.post("/admin/products",{name:r.product.name,price:r.product.price,category_id:p.value.id})).status==201&&(i.emit("showNotificationAlert",["success",`تم اضافة المنتج ${V.value} بنجاح!`]),u("fetchProducts")):(await P.put(`/admin/products/${r.product.id}`,{name:r.product.name,price:r.product.price,category_id:p.value.id})).status==200&&(i.emit("showNotificationAlert",["success",`تم تحديث المنتج ${V.value} بنجاح!`]),u("fetchProducts")),U()}catch{}finally{g.value=!1}},f=()=>$();return L(async()=>{await y.fetchAllCategoriesIds()}),(a,o)=>(x(),T(ae,{modelValue:v.value,"onUpdate:modelValue":o[3]||(o[3]=d=>v.value=d),"button-label":_.value,onSubmitData:f,loading:g.value},{title:k(()=>[z(E(c.value==="create"?"إضافة منتج جديد":"تعديل المنتج"),1)]),content:k(()=>[S(s("input",{"onUpdate:modelValue":o[0]||(o[0]=d=>m.product.name=d),type:"text",placeholder:"اسم المنتج",class:"w-full border rounded-lg px-3 py-2 mb-3 focus:ring-2 focus:ring-blue-400 outline-none"},null,512),[[A,m.product.name]]),s("div",oe,[S(s("input",{"onUpdate:modelValue":o[1]||(o[1]=d=>m.product.price=d),type:"number",placeholder:"سعر المنتج",class:"w-full border rounded-lg pr-7 py-2 mb-3 focus:ring-2 focus:ring-blue-400 outline-none appearance-none"},null,512),[[A,m.product.price]]),o[4]||(o[4]=s("span",{class:"absolute right-1 text-[25px] -mt-2 top-1/2 -translate-y-1/2 text-gray-700 dark:text-gray-200 px-2"}," ₪ ",-1))]),h(W,{placeholder:"اختر اسم التصنيف",modelValue:p.value,"onUpdate:modelValue":o[2]||(o[2]=d=>p.value=d),items:M(b)},null,8,["modelValue","items"])]),_:1},8,["modelValue","button-label","loading"]))}},se={class:"mb-4"},le={key:0,class:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 transition-colors duration-200"},de={class:"space-y-4"},ne={class:"grid grid-cols-6 gap-4 pb-4 border-b border-gray-200 dark:border-gray-700"},ue={class:"flex gap-2 justify-center"},ie=["onClick"],ce=["onClick"],ye={__name:"ProductView",setup(m){const N=[{text:"رقم المنتج",value:"id",sortable:!0},{text:"اسم المنتج",value:"name",sortable:!0},{text:"سعر المنتج",value:"price",sortable:!0},{text:"اسم التصنيف",value:"category_name",sortable:!0},{text:"تاريخ الإضافة",value:"created_at",sortable:!0},{text:"إجراءات",value:"actions"}],{formatDate:r,cleanId:u,currencyFormat:g}=K(),i=n([]),v=n(!0),V=n("create"),y=n({}),b=n(!1),C=(l,e={})=>{V.value=l,y.value=e,b.value=!0},p=l=>{const e=o.value.filter(t=>t.id==u(l.id))[0];C("edit",e)},c=n(""),U=w(()=>c.value?i.value.filter(l=>l.name.toLowerCase().includes(c.value.toLowerCase())):i.value),_=n(!1),$=n(""),f=H({}),a=I("emitter"),o=n({name:null,price:null,category_id:null}),d=({id:l,name:e=""})=>{$.value=`هل أنت متأكد من رغبتك بحذف المنتج "${e}"؟`,f.name=e,f.id=l,_.value=!0},G=async()=>{(await P.delete(`admin/products/${u(f.id)}`)).status==204&&(i.value=i.value.filter(e=>e.id!==f.id),a.emit("showNotificationAlert",["success","تم حذف المنتج بنجاح!"]))},j=async()=>{v.value=!0;try{await P.get("/admin/products").then(l=>{o.value=l.data.products,i.value=l.data.products.map(e=>({id:e.id,name:e.name,category_name:e.category.name,price:g(e.price,void 0,"ar","ILS"),created_at:r(e.created_at)}))})}catch{}finally{v.value=!1}};return L(async()=>{await j()}),(l,e)=>(x(),D(B,null,[h(Y,{title:"المنتجات",ButtonLabel:"اضافة منتج جديد",onButtonAddClick:e[0]||(e[0]=t=>C("create"))}),s("div",se,[S(s("input",{name:"product-search","onUpdate:modelValue":e[1]||(e[1]=t=>c.value=t),type:"text",placeholder:"ابحث عن منتج معين...",class:"w-full border rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 outline-none dark:bg-gray-700 dark:border-gray-600 dark:text-white placeholder:text-gray-600/60 dark:placeholder-gray-400"},null,512),[[A,c.value]])]),v.value?(x(),D("div",le,[s("div",de,[s("div",ne,[(x(),D(B,null,F(6,t=>s("div",{key:t,class:"h-5 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"})),64))]),(x(),D(B,null,F(8,t=>s("div",{key:t,class:"grid grid-cols-6 gap-4 py-4 border-b border-gray-200 dark:border-gray-700"},[...e[5]||(e[5]=[X('<div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="flex gap-2 justify-center"><div class="h-8 w-16 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div><div class="h-8 w-16 bg-gray-300 dark:bg-gray-700 rounded animate-pulse"></div></div>',6)])])),64))])])):(x(),T(Z,{key:1,headers:N,items:U.value},{id:k(({item:t})=>[s("span",null,"# "+E(t.id),1)]),actions:k(t=>[s("div",ue,[s("button",{onClick:O=>p(t.item),class:"bg-blue-600 text-white px-3 py-1 rounded"}," تعديل ",8,ie),s("button",{onClick:O=>d(t.item),class:"bg-red-600 text-white px-3 py-1 rounded"}," حذف ",8,ce)])]),"prev-icon":k(()=>[h(M(te),{class:"w-5"})]),"next-icon":k(()=>[h(M(ee),{class:"w-5"})]),_:1},8,["items"])),h(re,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),mode:V.value,product:y.value,"onUpdate:product":e[3]||(e[3]=t=>y.value=t),onFetchProducts:j},null,8,["modelValue","mode","product"]),h(J,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=t=>_.value=t),message:$.value,onConfirm:G},null,8,["modelValue","message"])],64))}};export{ye as default};
