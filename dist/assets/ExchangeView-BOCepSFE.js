import{_ as Te}from"./HeaderTitle-DK1zGWEz.js";import{c as f,o as d,a as e,x as me,y as M,g as ae,h as je,d as S,z as Ie,A as Q,B as ge,C as Y,D as De,E as Ne,G as ne,N as _e,I as ke,J as Le,K as we,i as oe,t as v,q as I,w as U,j as i,b as c,_ as J,L as pe,p as W,M as G,O as $e,P as Ee,Q as fe,V as Pe,R as re,l as B,S as He,T as xe,Y as Ze,U as ze,W as T,r as Fe,n as P,m as ve,s as ye,X as Ke,Z as We,$ as Qe,a0 as Se,a1 as Ve,a2 as Ge,a3 as Ye,F as N,a4 as te,a5 as Oe,a6 as Je,a7 as Xe,a8 as le,a9 as K,H as et,aa as de,ab as tt}from"./index-BlBeKsLJ.js";import{_ as X}from"./SelectListBox-C5TQ5uG5.js";import{s as at,r as st,a as rt}from"./listbox-C2KpOBbF.js";import{r as Ce}from"./UserIcon-BL1lMDJK.js";import{r as ue}from"./CheckIcon-enk7v0_e.js";import{r as lt}from"./ShieldCheckIcon-GBP3dlsm.js";import{_ as nt}from"./LogoSection.vue_vue_type_script_setup_true_lang-Dg6w-Ry2.js";function ot(a,m){return d(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"})])}function it(a,m){return d(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.625 9.75a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375m-13.5 3.01c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.184-4.183a1.14 1.14 0 0 1 .778-.332 48.294 48.294 0 0 0 5.83-.498c1.585-.233 2.708-1.626 2.708-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"})])}function ce(a,m){return d(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 20.25c4.97 0 9-3.694 9-8.25s-4.03-8.25-9-8.25S3 7.444 3 12c0 2.104.859 4.023 2.273 5.48.432.447.74 1.04.586 1.641a4.483 4.483 0 0 1-.923 1.785A5.969 5.969 0 0 0 6 21c1.282 0 2.47-.402 3.445-1.087.81.22 1.668.337 2.555.337Z"})])}function dt(a,m){return d(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"})])}function ut(a,m){return d(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function ct(a,m){return d(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"})])}function mt(a,m){return d(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 12h14"})])}function Ue(a,m){return d(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})])}function gt(a,m){return d(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})])}function pt(a,m){return d(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})])}function ft(a,m){return d(),f("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})])}var xt=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(xt||{});let qe=Symbol("DisclosureContext");function be(a){let m=oe(qe,null);if(m===null){let n=new Error(`<${a} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,be),n}return m}let Ae=Symbol("DisclosurePanelContext");function vt(){return oe(Ae,null)}let yt=me({name:"Disclosure",props:{as:{type:[Object,String],default:"template"},defaultOpen:{type:[Boolean],default:!1}},setup(a,{slots:m,attrs:n}){let h=S(a.defaultOpen?0:1),l=S(null),V=S(null),t={buttonId:S(`headlessui-disclosure-button-${ke()}`),panelId:S(`headlessui-disclosure-panel-${ke()}`),disclosureState:h,panel:l,button:V,toggleDisclosure(){h.value=we(h.value,{0:1,1:0})},closeDisclosure(){h.value!==1&&(h.value=1)},close(p){t.closeDisclosure();let x=p?p instanceof HTMLElement?p:p.value instanceof HTMLElement?Q(p):Q(t.button):Q(t.button);x?.focus()}};return De(qe,t),Le(M(()=>we(h.value,{0:ne.Open,1:ne.Closed}))),()=>{let{defaultOpen:p,...x}=a,w={open:h.value===0,close:t.close};return ge({theirProps:x,ourProps:{},slot:w,slots:m,attrs:n,name:"Disclosure"})}}}),bt=me({name:"DisclosureButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(a,{attrs:m,slots:n,expose:h}){let l=be("DisclosureButton"),V=vt(),t=M(()=>V===null?!1:V.value===l.panelId.value);ae(()=>{t.value||a.id!==null&&(l.buttonId.value=a.id)}),je(()=>{t.value||(l.buttonId.value=null)});let p=S(null);h({el:p,$el:p}),t.value||Ie(()=>{l.button.value=p.value});let x=at(M(()=>({as:a.as,type:m.type})),p);function w(){var r;a.disabled||(t.value?(l.toggleDisclosure(),(r=Q(l.button))==null||r.focus()):l.toggleDisclosure())}function C(r){var s;if(!a.disabled)if(t.value)switch(r.key){case Y.Space:case Y.Enter:r.preventDefault(),r.stopPropagation(),l.toggleDisclosure(),(s=Q(l.button))==null||s.focus();break}else switch(r.key){case Y.Space:case Y.Enter:r.preventDefault(),r.stopPropagation(),l.toggleDisclosure();break}}function O(r){switch(r.key){case Y.Space:r.preventDefault();break}}return()=>{var r;let s={open:l.disclosureState.value===0},{id:u,...o}=a,y=t.value?{ref:p,type:x.value,onClick:w,onKeydown:C}:{id:(r=l.buttonId.value)!=null?r:u,ref:p,type:x.value,"aria-expanded":l.disclosureState.value===0,"aria-controls":l.disclosureState.value===0||Q(l.panel)?l.panelId.value:void 0,disabled:a.disabled?!0:void 0,onClick:w,onKeydown:C,onKeyup:O};return ge({ourProps:y,theirProps:o,slot:s,attrs:m,slots:n,name:"DisclosureButton"})}}}),ht=me({name:"DisclosurePanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null}},setup(a,{attrs:m,slots:n,expose:h}){let l=be("DisclosurePanel");ae(()=>{a.id!==null&&(l.panelId.value=a.id)}),je(()=>{l.panelId.value=null}),h({el:l.panel,$el:l.panel}),De(Ae,l.panelId);let V=Ne(),t=M(()=>V!==null?(V.value&ne.Open)===ne.Open:l.disclosureState.value===0);return()=>{var p;let x={open:l.disclosureState.value===0,close:l.close},{id:w,...C}=a,O={id:(p=l.panelId.value)!=null?p:w,ref:l.panel};return ge({ourProps:O,theirProps:C,slot:x,attrs:m,slots:n,features:_e.RenderStrategy|_e.Static,visible:t.value,name:"DisclosurePanel"})}}});const _t={class:"p-4 rounded-lg bg-yellow-50 dark:bg-yellow-900/40 border border-yellow-300 dark:border-yellow-700"},kt={class:"title text-yellow-800 dark:text-yellow-200 font-medium mb-1"},wt={class:"text text-yellow-800 dark:text-yellow-200 text-[14px] font-extralight"},$t={__name:"WarningAlert",props:{title:{type:String,required:!0},text:{type:String,required:!0}},setup(a){return(m,n)=>(d(),f("div",_t,[e("h5",kt,v(a.title),1),e("p",wt,v(a.text),1)]))}},Ct={__name:"ProductDetailsForm",props:{quantity:{type:[String,Object],default:""},contact_method:{type:[String,Object],default:""},availability:{type:[String,Object],default:""},exchange_preferences:{type:[String,Object],default:""},offer_status:{type:[String,Object],default:""}},emits:["update:quantity","update:contact_method","update:availability","update:exchange_preferences","update:offer_status"],setup(a,{emit:m}){const n=a,h=m,l=[{id:1,name:"واتساب"},{id:2,name:"مكالمات هاتفية"},{id:3,name:"رسائل نصية"},{id:3,name:"عبر التطبيق فقط"},{id:3,name:"واتساب + مكالمة"}],V=[{id:1,name:"جديد - لم يستعمل"},{id:2,name:"ممتاز - استعمال خفيف"},{id:3,name:"جيد - استعمال عادي"},{id:3,name:"مقبول - يحتاج صيانة بسيطة"},{id:3,name:"طازج - المواد الغذلئية"},{id:3,name:"مغلق - لم يفتح"}],t=[{id:1,name:"قطعة واحدة"},{id:2,name:"كمية صغيرة (5 - 2)"},{id:3,name:"كمية متوسطة (10 - 6)"},{id:3,name:"كبية كبيرة (اكثر من 10)"},{id:3,name:"1 كيلو"},{id:3,name:"5 كيلو"},{id:3,name:"10 كيلو"},{id:3,name:"1 لتر"},{id:3,name:"5 لتر"},{id:3,name:"كمية متخصصة (حدد في الوصف)"}],p=[{id:3,name:"متوفر الان"},{id:3,name:"متوفر اليوم"},{id:3,name:"متوفر غذا"},{id:3,name:"متوفر في العطلة نهاية الاسبوع"},{id:3,name:"متوفر صباحا (6ص - 12ظ)"},{id:3,name:"متوفر بعد الظهر (12ظ - 6م)"},{id:3,name:"متوفر مساء (6م - 10م)"},{id:3,name:"مرونة في التوقيت"}],x=[{id:3,name:"تبادل مباشر مفضل"},{id:3,name:"مقابلة في مكان عام"},{id:3,name:"تسليم منزلي ممكن"},{id:3,name:"استلام من المنزل"},{id:3,name:"اللقاء في منتصف المسافة"},{id:3,name:"بالقرب من المسجد"},{id:3,name:"في السوق"},{id:3,name:"مرونة في المكان"}],w=M({get(){return n.contact_method&&typeof n.contact_method=="object"?n.contact_method:l.find(u=>u.name==n.contact_method)},set(u){h("update:contact_method",u)}}),C=M({get(){return n.offer_status&&typeof n.offer_status=="object"?n.offer_status:V.find(u=>u.name==n.offer_status)},set(u){h("update:offer_status",u)}}),O=M({get(){return n.quantity&&typeof n.quantity=="object"?n.quantity:t.find(u=>u.name==n.quantity)},set(u){h("update:quantity",u)}}),r=M({get(){return n.exchange_preferences&&typeof n.exchange_preferences=="object"?n.exchange_preferences:x.find(u=>u.name==n.exchange_preferences)},set(u){h("update:exchange_preferences",u)}}),s=M({get(){return n.availability&&typeof n.availability=="object"?n.availability:p.find(u=>u.name==n.availability)},set(u){h("update:availability",u)}});return(u,o)=>(d(),I(c(yt),null,{default:U(({open:y})=>[i(c(bt),{class:"w-full px-4 border py-2 text-right border-gray-300 text-[14px] text-gray-500 font-normal dark:text-white focus:border-gray-500 bg-white dark:bg-gray-700 rounded-md flex justify-between items-center"},{default:U(()=>[o[5]||(o[5]=e("span",null,"إضافة تفاصيل",-1)),e("span",null,[y?(d(),I(c(st),{key:0,class:"w-5 h-5 text-gray-500 dark:text-gray-300"})):(d(),I(c(rt),{key:1,class:"w-5 h-5 text-gray-500 dark:text-gray-300"}))])]),_:2},1024),i(c(ht),{class:"mt-2 space-y-3"},{default:U(()=>[i(J,{label:"التواصل"}),i(X,{modelValue:w.value,"onUpdate:modelValue":o[0]||(o[0]=j=>w.value=j),options:l,class:"w-full",label:"اختر طريقة التوصل"},null,8,["modelValue"]),i(J,{label:"الحالة"}),i(X,{modelValue:C.value,"onUpdate:modelValue":o[1]||(o[1]=j=>C.value=j),options:V,class:"w-full",label:"حالة السلعة المعروضة"},null,8,["modelValue"]),i(J,{label:"الكمية"}),i(X,{modelValue:O.value,"onUpdate:modelValue":o[2]||(o[2]=j=>O.value=j),options:t,class:"w-full",label:"كمية السلعة المعروضة"},null,8,["modelValue"]),i(J,{label:"التوفر"}),i(X,{modelValue:s.value,"onUpdate:modelValue":o[3]||(o[3]=j=>s.value=j),options:p,class:"w-full",label:"متى السلعة متوفرة للتبادل"},null,8,["modelValue"]),i(J,{label:"تفضيلات التبادل"}),i(X,{modelValue:r.value,"onUpdate:modelValue":o[4]||(o[4]=j=>r.value=j),options:x,class:"w-full",label:"كيف تفضل اتمام التبادل"},null,8,["modelValue"])]),_:1})]),_:1}))}},jt={class:"fixed inset-0 flex items-center justify-center p-4 overflow-auto"},Dt={class:"absolute top-4 right-4"},St={class:"font-medium text-lg text-black dark:text-white"},Vt={class:"text-gray-600 dark:text-gray-300 text-sm mt-1"},Ot={class:"space-y-4"},Ut={for:"file_image",class:"flex items-center gap-2 cursor-pointer justify-center border border-gray-300 dark:border-gray-600 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all rounded-md"},qt={class:"dark:text-white"},At={key:0,class:"mt-2"},Bt=["src"],Mt={__name:"TradeDialog",props:{modelValue:{type:Boolean,required:!0},editData:{type:Object,default:null}},emits:["update:modelValue","success"],setup(a,{emit:m}){const n=a,h=m,l=oe("emitter"),V=M(()=>!!n.editData?.offer_item),t=W({offer_item:"",request_item:"",description:"",location:"",image:null,quantity:null,contact_method:null,availability:null,exchange_preferences:null,offer_status:null,image_url:null});function p(o){return o==null||typeof o=="string"&&o.trim().toLowerCase()==="undefined"?"":o}G(()=>n.modelValue,o=>{o&&n.editData?Object.assign(t,{offer_item:p(n.editData.offer_item),request_item:p(n.editData.request_item),description:p(n.editData.description),location:p(n.editData.location),quantity:n.editData.quantity,contact_method:n.editData.contact_method,availability:n.editData.availability,exchange_preferences:n.editData.exchange_preferences,offer_status:n.editData.offer_status,image_url:n.editData.image||null,image:null}):o||x()});function x(){t.offer_item="",t.request_item="",t.description="",t.location="",t.quantity=null,t.contact_method=null,t.availability=null,t.exchange_preferences=null,t.offer_status=null,t.image=null,t.image_url=null}function w(o){const y=o.target.files[0];t.image=y,t.image_url=URL.createObjectURL(y)}function C(){h("update:modelValue",!1)}const O=S(!1),r=W({offer_item:"",request_item:"",description:"",location:""});function s(o){return o!=null&&String(o).trim()!==""&&String(o).trim()!=="null"&&String(o).trim()!=="undefined"&&String(o).trim().length>0}const u=async()=>{try{if(O.value=!0,t.offer_item=p(t.offer_item),t.request_item=p(t.request_item),t.description=p(t.description),t.location=p(t.location),r.offer_item=s(t.offer_item)?"":"هذا الحقل مطلوب",r.request_item=s(t.request_item)?"":"هذا الحقل مطلوب",r.description=s(t.description)?"":"هذا الحقل مطلوب",r.location=s(t.location)?"":"هذا الحقل مطلوب",r.offer_item||r.request_item||r.description||r.location)return;const o=new FormData;o.append("offer_item",t.offer_item),o.append("request_item",t.request_item),o.append("description",t.description),o.append("location",t.location),o.append("quantity",t.quantity?.name||""),o.append("contact_method",t.contact_method?.name||""),o.append("availability",t.availability?.name||""),o.append("exchange_preferences",t.exchange_preferences?.name||""),o.append("offer_status",t.offer_status?.name||""),t.image&&o.append("image",t.image);let y;V.value?y=await T.post(`barters/${n.editData.id}?_method=PUT`,o,{headers:{"Content-Type":"multipart/form-data"}}):y=await T.post("barters",o,{headers:{"Content-Type":"multipart/form-data"}}),y.status===200&&(l.emit("showNotificationAlert",["success",V.value?"تم تحديث العرض بنجاح!":"تم نشر عرض المقايضة بنجاح!"]),h("success"),C())}catch{}finally{O.value=!1}};return(o,y)=>(d(),I(c(ze),{show:a.modelValue,as:"template"},{default:U(()=>[i(c(Ze),{onClose:C,class:"relative z-50"},{default:U(()=>[i(c($e),{as:"template",enter:"ease-out duration-200","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:U(()=>[...y[9]||(y[9]=[e("div",{class:"fixed inset-0 bg-black/30","aria-hidden":"true"},null,-1)])]),_:1}),e("div",jt,[i(c($e),{as:"template",enter:"ease-out duration-200","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:U(()=>[i(c(Ee),{class:"w-full max-w-md p-6 bg-white dark:bg-gray-800 rounded-lg relative max-h-[90vh] overflow-auto shadow-lg"},{default:U(()=>[e("div",Dt,[e("span",{class:"text-gray-600 hover:text-gray-800 dark:text-gray-300 dark:hover:text-white cursor-pointer transition-all",onClick:C},[i(c(fe),{class:"w-5 h-5"})])]),i(c(Pe),{class:"pt-6 mb-4"},{default:U(()=>[e("h3",St,v(V.value?"تعديل عرض مقايضة":"إضافة عرض مقايضة"),1),e("p",Vt,v(V.value?"قم بتحديث تفاصيل العرض":"أضف تفاصيل عرض المقايضة الخاص بك"),1)]),_:1}),e("div",Ot,[i(re,{id:"offer_item",label:"ماذا تعرض؟",placeholder:"مثال: 5 لتر بنزين",modelValue:t.offer_item,"onUpdate:modelValue":y[0]||(y[0]=j=>t.offer_item=j),"error-message":r.offer_item},null,8,["modelValue","error-message"]),i(re,{id:"request_item",label:"ماذا تريد؟",placeholder:"مثال: حليب اطفال",modelValue:t.request_item,"onUpdate:modelValue":y[1]||(y[1]=j=>t.request_item=j),"error-message":r.request_item},null,8,["modelValue","error-message"]),i(re,{id:"description",label:"الوصف",placeholder:"تفاصيل اضافية عن العرض",type:"textarea",modelValue:t.description,"onUpdate:modelValue":y[2]||(y[2]=j=>t.description=j),"error-message":r.description},null,8,["modelValue","error-message"]),i(re,{id:"location",label:"الموقع",placeholder:"المنطقة او الحي",modelValue:t.location,"onUpdate:modelValue":y[3]||(y[3]=j=>t.location=j),"error-message":r.location},null,8,["modelValue","error-message"]),i(Ct,{quantity:t.quantity,"onUpdate:quantity":y[4]||(y[4]=j=>t.quantity=j),contact_method:t.contact_method,"onUpdate:contact_method":y[5]||(y[5]=j=>t.contact_method=j),availability:t.availability,"onUpdate:availability":y[6]||(y[6]=j=>t.availability=j),exchange_preferences:t.exchange_preferences,"onUpdate:exchange_preferences":y[7]||(y[7]=j=>t.exchange_preferences=j),offer_status:t.offer_status,"onUpdate:offer_status":y[8]||(y[8]=j=>t.offer_status=j)},null,8,["quantity","contact_method","availability","exchange_preferences","offer_status"]),e("div",null,[e("label",Ut,[i(c(He),{class:"w-4 h-4 text-gray-600 dark:text-gray-300"}),e("span",qt,v(V.value?"تغيير الصورة":"إضافة صورة"),1)]),e("input",{type:"file",id:"file_image",onChange:w,hidden:""},null,32),t.image_url?(d(),f("div",At,[e("img",{src:t.image_url,alt:"Preview",class:"w-auto mx-auto h-auto max-h-48 object-cover rounded-md"},null,8,Bt)])):B("",!0)]),i(xe,{label:O.value?"جاري الحفظ...":V.value?"تحديث العرض":"نشر العرض",class:"py-3",onClick:u},null,8,["label"])])]),_:1})]),_:1})])]),_:1})]),_:1},8,["show"]))}},Rt=pe(Mt,[["__scopeId","data-v-8006898a"]]),Tt={class:"font-medium text-[13px]"},ee=Object.assign({inheritAttrs:!1},{__name:"SecondButton",props:{title:{type:String,required:!0}},setup(a){return(m,n)=>(d(),f("button",{class:P([[m.$attrs.class],"flex-1 flex items-center gap-3 w-full justify-center p-[6px] border-2 transition-all rounded-lg text-[14px]"]),onClick:n[0]||(n[0]=h=>m.$emit("click"))},[Fe(m.$slots,"icon"),e("span",Tt,v(a.title),1)],2))}}),It={class:"single-offer p-4 bg-white dark:bg-gray-900 rounded-[10px] hover:shadow-md dark:shadow-[inset_0_6px_10px_rgba(255,255,255,0.15),0_4px_4px_0_rgba(0,0,0,0.75)] transition relative my-4 last-of-type:mb-0"},Nt={class:"flex items-center justify-between mb-4"},Lt={class:"info flex items-center gap-2"},Et={class:"icon bg-gray-100 dark:bg-gray-700 h-10 w-10 flex items-center justify-center rounded-full"},Pt={class:""},Ht={class:"font-normal flex items-center"},Zt={class:"text-lg text-gray-800 dark:text-white font-medium"},zt={key:0,class:"dark:border-green-600 py-1.5 px-2 bg-green-100/90 dark:bg-green-900/50 rounded-full flex items-center ml-2 gap-1 w-fit justify-center mr-2"},Ft={class:"degree text-slate-500 dark:text-gray-300 text-xs font-normal mt-1"},Kt={class:"flex items-center justify-center gap-4 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg"},Wt={class:"flex flex-col items-center"},Qt={class:"text-teal-700 dark:text-green-400 font-normal"},Gt={class:"flex flex-col items-center"},Yt={class:"text-blue-600 dark:text-blue-300 dark:saturate-200 font-normal"},Jt={class:"text-[14px] text-gray-600 dark:text-gray-300 font-normal mt-4"},Xt={class:"message"},ea={class:"location flex items-center justify-between mt-2"},ta={class:"inline-block mr-1 text-[12px] text-gray-500 dark:text-gray-400"},aa={class:"time flex items-center gap-1"},sa={class:"inline-block mr-1 text-[12px] text-gray-500 dark:text-gray-400"},ra={class:"flex flex-col gap-2 mt-4"},la={class:"flex items-center gap-2"},na={class:"p-2 text-gray-600 w-full transition-all"},oa={class:"info-user bg-blue-50 border border-blue-100 p-4 rounded-lg dark:bg-blue-900/20 dark:border-blue-700"},ia={class:"flex items-center gap-2 mb-4"},da={class:"flex flex-col gap-3"},ua={class:"flex items-start sm:items-center flex-col sm:flex-row gap-2 justify-between"},ca={class:"flex flex-1 gap-2 items-center"},ma={class:"flex items-center gap-1"},ga={class:"icon flex items-center"},pa={class:"value text-black font-normal text-[14px] dark:text-white"},fa={class:"rate ml-1"},xa={class:"opration"},va={class:"flex flex-1"},ya={class:"flex items-center gap-1"},ba={class:"icon flex items-center"},ha={class:"text-gray-600 text-[14px] font-normal dark:text-gray-400"},_a={class:"flex items-start sm:items-center flex-col sm:flex-row gap-2 justify-start"},ka={class:"flex flex-1 gap-2 items-center"},wa={class:"flex items-center gap-1"},$a={class:"icon flex items-center"},Ca={class:"value text-black font-normal text-[14px] dark:text-white"},ja={class:"flex flex-1 gap-2 items-center"},Da={class:"flex items-center gap-1"},Sa={class:"icon flex items-center"},Va={class:"value text-green-700 font-normal text-[14px] dark:text-green-400"},Oa={class:"cart-details bg-green-50 border border-green-100 p-4 rounded-lg mt-4 dark:bg-green-900/20 dark:border-green-700"},Ua={class:"flex items-center gap-2 mb-4"},qa={class:"jsutify-between mb-2 flex items-start sm:items-center flex-col sm:flex-row gap-2"},Aa={class:"flex-1"},Ba={class:"text-green-700 text-[14px] font-medium block dark:text-green-300"},Ma={class:"flex-1"},Ra={class:"text-green-700 text-[14px] font-medium block dark:text-green-300"},Ta={class:"flex items-center jsutify-between mb-2"},Ia={class:"flex-1"},Na={class:"text-green-700 text-[14px] font-medium block dark:text-green-300"},La={class:"flex items-center jsutify-between"},Ea={class:"flex-1"},Pa={class:"text-green-700 text-[14px] font-medium block dark:text-green-300"},Ha={class:"cart-details bg-gray-50 border border-gray-100 p-4 rounded-lg mt-4 dark:bg-gray-800 dark:border-gray-700"},Za={class:"text-gray-500 text-[14px] font-normal dark:text-gray-300"},za={key:0,class:"cart-details bg-blue-50 border border-blue-100 p-4 rounded-lg mt-4 dark:bg-blue-800/20 dark:border-blue-700/40"},Fa={class:"text-gray-500 text-[14px] font-normal dark:text-gray-300"},Ka={class:"mt-4"},Wa={class:"grid grid-cols-3 border-b last-of-type:border-none border-b-gray-200 gap-4 mb-2"},Qa={class:""},Ga={class:"flex justify-center"},Ya=["onClick"],Ja={key:0,class:"border-2 border-green-600 text-sm rounded-full cursor-default px-4 py-1 gap-1 bg-green-600 text-white font-normal flex justify-center items-center"},Xa={key:1,class:"border-2 border-red-600 text-sm rounded-full cursor-default px-4 py-1 gap-1 bg-red-600 text-white font-normal flex justify-center items-center"},es={class:"flex items-center gap-2 mb-3"},ts={key:2,class:"cart-details bg-gray-50 border border-gray-100 p-4 rounded-lg mt-4 dark:bg-gray-800 dark:border-gray-700"},as={class:"text-gray-500 text-[14px] font-normal dark:text-gray-300"},ss=["src","alt"],rs={class:"flex flex-col sm:flex-row items-center justify-between mt-4 gap-2"},ls={__name:"SingleOffer",props:{item:{type:Object,required:!0}},setup(a){const m=a,{getRelativeTime:n}=Se(),h=ve(),{user:l}=ye(h),V=S(!1);function t(){V.value=!V.value}const p=M(()=>!!m.item.myResponse),x=S(null),w=S(null),C=async()=>{if(m.item?.user?.id){try{const r=await T.get("/chat/user/reliability-score",{params:{user_id:m.item.user.id}});x.value=r.data.score||0}catch{x.value=0}w.value=m.item?.user?.rating||m.item?.user?.store?.rating||4}};ae(()=>{C()}),G(()=>m.item?.user?.id,()=>{C()});const O=M(()=>{const r=m.item.myResponse?.status;return r=="accepted"?{text:"مقبول",parent_style:"bg-green-50 border border-green-100 p-4 dark:bg-green-800 dark:border-green-700",label_style:"text-green-800 dark:text-white",text_style:"text-green-600 dark:text-green-300"}:r=="rejected"?{text:"تم رفضه",parent_style:"bg-red-50 border border-red-100 p-4 dark:bg-red-800 dark:border-red-700",label_style:"text-red-800 dark:text-white",text_style:"text-red-600 dark:text-red-300"}:{text:"معلق",parent_style:"bg-orange-50 border border-orange-100 p-4 dark:bg-orange-800 dark:border-orange-700",label_style:"text-orange-800 dark:text-white",text_style:"text-orange-600 dark:text-orange-300"}});return(r,s)=>(d(),f("div",It,[e("div",Nt,[e("div",Lt,[e("div",Et,[i(c(Ce),{class:"w-5 h-5 text-gray-950 dark:text-gray-300"})]),e("div",Pt,[e("span",Ht,[e("span",Zt,v(a.item.user.name),1),a.item.user.is_trusty?(d(),f("span",zt,[i(c(ue),{class:"w-3 h-3 text-gray-600 dark:text-green-600 hidden"}),s[6]||(s[6]=e("span",{class:"text-xs text-green-700 dark:text-green-500 leading-none"},"موثوق",-1))])):B("",!0)]),e("div",Ft," درجة الموثوقية: "+v(x.value!==null?Math.round(x.value)+"%":"..."),1)])]),s[7]||(s[7]=e("div",{class:"text-white bg-red-600 dark:bg-red-500 rounded-md w-12 h-6 px-7 flex items-center justify-center"},[e("span",{class:"font-medium text-[10px] leading-none"},"عاجل")],-1))]),e("div",Kt,[e("div",Wt,[s[8]||(s[8]=e("span",{class:"font-normal text-[14px] text-gray-500 dark:text-gray-300"},"يعرض",-1)),e("span",Qt,v(a.item.offer_item),1)]),i(c(Ke),{class:"w-5 h-5 text-gray-600 dark:text-gray-300"}),e("div",Gt,[s[9]||(s[9]=e("span",{class:"font-normal text-[14px] text-gray-500 dark:text-gray-300"},"يريد",-1)),e("span",Yt,v(a.item.request_item),1)])]),e("div",Jt,[e("div",Xt,v(a.item.description),1),e("div",ea,[e("div",null,[i(c(We),{class:"w-4 h-4 text-gray-600 dark:text-gray-300 inline-block"}),e("span",ta,v(a.item.location),1)]),e("span",aa,[i(c(Qe),{class:"w-4 h-4 text-gray-600 dark:text-gray-300 inline-block"}),e("span",sa,v(c(n)(a.item.created_at)),1)])])]),e("div",ra,[e("div",la,[e("button",{onClick:t,class:"flex-1 flex items-center justify-center p-2 border rounded-lg text-[14px] transition-all border-gray-300 bg-white text-black hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700"},[s[10]||(s[10]=e("span",{class:"font-medium"},"تفاصيل اكثر",-1)),i(c(ut),{class:P([V.value?"rotate-180 transform":"","w-4 h-4 mr-2 mt-[2px] transition-transform text-black dark:text-white"])},null,8,["class"])]),a.item.user.id!=c(l).id?(d(),I(xe,{key:0,class:"text-[14px] flex-1",label:"بدا المحادثة",onClick:s[0]||(s[0]=u=>r.$emit("startChat",a.item.user))})):B("",!0)]),Ve(e("div",na,[e("div",oa,[e("div",ia,[i(c(Ce),{class:"w-4 h-4 text-blue-900 dark:text-blue-400"}),s[11]||(s[11]=e("span",{class:"font-medium text-blue-900 text-[16px] dark:text-blue-300"}," معلومات المستخدم ",-1))]),e("div",da,[e("div",ua,[e("div",ca,[e("span",ma,[e("span",ga,[i(c(Ye),{class:"w-4 h-4 inline-block text-amber-600 dark:text-amber-400"})]),s[12]||(s[12]=e("span",{class:"text-gray-600 text-[14px] font-normal dark:text-gray-400"}," التقييم: ",-1))]),e("span",pa,[e("span",fa,v(w.value!==null?w.value.toFixed(1):"4.0")+"/5",1),e("span",xa,"("+v(a.item.batar_count??0)+" عملية)",1)])]),e("div",va,[e("span",ya,[e("span",ba,[i(c(ot),{class:"w-[14px] h-[14px] text-blue-700 dark:text-blue-400 inline-block"})]),e("span",ha," عضو "+v(c(n)(a.item.user.created_at).replace("قبل","منذ")),1)])])]),e("div",_a,[e("div",ka,[e("span",wa,[e("span",$a,[i(c(ce),{class:"w-[14px] h-[14px] text-green-700 dark:text-green-400 inline-block"})]),s[13]||(s[13]=e("span",{class:"text-gray-600 text-[14px] font-normal dark:text-gray-400"}," التواصل: ",-1))]),e("span",Ca,v(a.item.contact_method??"-"),1)]),e("div",ja,[e("span",Da,[e("span",Sa,[i(c(lt),{class:"w-[15px] h-[15px] text-green-700 dark:text-green-400 inline-block"})]),s[14]||(s[14]=e("span",{class:"text-gray-600 text-[14px] font-normal dark:text-gray-400"}," درجة الثقة: ",-1))]),e("span",Va,v(x.value!==null?Math.round(x.value)+"%":"..."),1)])])])]),e("div",Oa,[e("div",Ua,[i(c(ct),{class:"w-4 h-4 text-green-900 dark:text-green-400"}),s[15]||(s[15]=e("span",{class:"font-medium text-green-900 text-[16px] dark:text-green-300"}," تفاصيل السة المعروضة ",-1))]),e("div",null,[e("div",qa,[e("div",Aa,[s[16]||(s[16]=e("span",{class:"text-gray-500 text-[14px] font-normal block dark:text-gray-400"},"الحالة:",-1)),e("span",Ba,v(a.item.offer_status??"-"),1)]),e("div",Ma,[s[17]||(s[17]=e("span",{class:"text-gray-500 text-[14px] font-normal block dark:text-gray-400"},"الكمية:",-1)),e("span",Ra,v(a.item.quantity??"-"),1)])]),e("div",Ta,[e("div",Ia,[s[18]||(s[18]=e("span",{class:"text-gray-500 text-[14px] font-normal block dark:text-gray-400"},"التوفر:",-1)),e("span",Na,v(a.item.availability??"-"),1)])]),e("div",La,[e("div",Ea,[s[19]||(s[19]=e("span",{class:"text-gray-500 text-[14px] font-normal block dark:text-gray-400"},"تفضيلات التبادل:",-1)),e("span",Pa,v(a.item.exchange_preferences??"-"),1)])])])]),e("div",Ha,[s[20]||(s[20]=e("div",{class:"flex items-center gap-2 mb-3"},[e("span",{class:"font-medium text-dark text-[16px] dark:text-white"},"وصف مفصل")],-1)),e("div",Za,[e("p",null,v(a.item.description),1)])]),c(l)?.id==a.item.user_id&&a.item.sentResponses.length?(d(),f("div",za,[s[24]||(s[24]=e("div",{class:"flex items-center gap-2 mb-3"},[e("span",{class:"font-medium text-green-800 text-[16px] dark:text-white"},"المستخدمين المستعدون لقبول عملية التبادل")],-1)),e("div",Fa,[e("ul",Ka,[s[23]||(s[23]=e("li",{class:"grid grid-cols-3 mb-3 text-green-700 font-medium"},[e("span",null,"اسم المستخدم"),e("span",null,"تاريخ ارسال الطلب"),e("span",{class:"text-center"},"الاجراء")],-1)),e("li",null,[(d(!0),f(N,null,te(a.item.sentResponses,u=>(d(),f("ul",{key:u.id},[e("li",Wa,[e("span",Qa,v(u.user.name),1),e("span",null,v(c(n)(u.created_at).replace("قبل","منذ")),1),e("span",Ga,[a.item.accepted_by?(d(),f(N,{key:1},[u.user_id==a.item.accepted_by?(d(),f("span",Ja,[i(c(ue),{class:"w-[18px]"}),s[21]||(s[21]=e("span",null,"تم قبوله",-1))])):(d(),f("span",Xa,[i(c(fe),{class:"w-[18px]"}),s[22]||(s[22]=e("span",null,"تم رفضه",-1))]))],64)):(d(),f("span",{key:0,onClick:o=>r.$emit("acceptUser",u),class:"border-2 border-green-600 text-sm rounded-lg cursor-pointer px-4 py-1 text-green-700 font-normal flex justify-center items-center transition-colors hover:text-white hover:bg-green-600"},"قبول",8,Ya))])])]))),128))])])])])):B("",!0),p.value?(d(),f("div",{key:1,class:P(["cart-details border p-4 rounded-lg mt-4",O.value.parent_style])},[e("div",es,[e("span",{class:P(["font-medium text-dark text-[16px]",O.value.label_style])},"حالة طلبك",2)]),e("div",{class:P(["text-[14px] font-normal",O.value.text_style])},[e("p",null,v(O.value.text),1)],2)],2)):B("",!0),a.item.image?(d(),f("div",ts,[s[25]||(s[25]=e("div",{class:"flex items-center gap-2 mb-3"},[e("span",{class:"font-medium text-dark text-[16px] dark:text-white"},"الصورة")],-1)),e("div",as,[e("img",{src:a.item.image,alt:a.item.name,class:"max-h-[250px]"},null,8,ss)])])):B("",!0),e("div",rs,[c(l)&&c(l).id!==a.item.user_id?(d(),f(N,{key:0},[i(ee,{title:"رسالة سريعة",class:"text-black hover:bg-gray-50 dark:text-white hover:text-black dark:hover:text-black border-gray-300",onClick:s[1]||(s[1]=u=>r.$emit("startChat",a.item.user))},{icon:U(()=>[i(c(ce),{class:"w-4 h-4"})]),_:1}),p.value?B("",!0):(d(),I(ee,{key:0,title:"إرسال طلب لقبول المبادلة",class:"text-green-700 dark:text-green-500 hover:bg-green-700 hover:text-white dark:hover:text-white border-green-600",onClick:s[2]||(s[2]=u=>r.$emit("sendAcceptResponse",a.item))},{icon:U(()=>[i(c(Ue),{class:"w-4 h-4"})]),_:1}))],64)):(d(),f(N,{key:1},[a.item.accepted_by?(d(),I(ee,{key:0,title:"تم اكتمام العملية",class:"text-green-600 hover:bg-green-600 hover:text-white border-green-600",onClick:s[3]||(s[3]=u=>r.$emit("markAsComplete",a.item.id))},{icon:U(()=>[i(c(dt),{class:"w-5 h-5"})]),_:1})):(d(),I(ee,{key:1,title:"تعديل العرض",onClick:s[4]||(s[4]=u=>r.$emit("edit",a.item)),class:"bg-blue-600 hover:bg-blue-500 text-white border-blue-600"},{icon:U(()=>[i(c(gt),{class:"w-4 h-4"})]),_:1})),i(ee,{title:"حذف العرض",class:"text-white bg-red-600 hover:bg-red-500 border-red-600",onClick:s[5]||(s[5]=u=>r.$emit("delete",a.item.id))},{icon:U(()=>[i(c(ft),{class:"w-4 h-4"})]),_:1})],64))])],512),[[Ge,V.value]])])]))}},ns={class:"border-b border-gray-200 dark:border-gray-700 mb-0"},os={class:"p-5 flex items-center justify-between"},is={class:"info flex items-center gap-2"},ds={class:"icon text-black dark:text-white text-[12px] font-medium bg-gray-100 dark:bg-gray-700 h-9 w-9 flex items-center justify-center rounded-full"},us={class:"font-medium flex"},cs={class:"text-black dark:text-white text-[14px]"},ms={key:0,class:"text-[11px] border border-gray-200 dark:border-gray-600 w-[18px] h-[18px] rounded-full flex items-center gap-1 ml-2 justify-center mr-2"},gs={class:"icon flex items-center gap-2"},ps={key:0,class:"text-center py-2 text-gray-500"},fs={key:0,class:"send-message bg-black dark:bg-blue-600 rounded-xl p-3 w-fit mb-4 max-w-56 pb-2 ml-auto text-right"},xs={class:"text-white text-[13px]"},vs={class:"time text-gray-400 text-[11px]"},ys={key:1,class:"recived-message bg-gray-200 dark:bg-gray-700 rounded-xl p-3 pb-2 w-fit mb-4 max-w-56 mr-auto"},bs={class:"text-black dark:text-white text-[13px]"},hs={class:"time text-gray-400 text-[11px]"},_s={key:1,class:"text-center py-2 text-gray-500"},ks={class:"send p-4 flex items-center gap-2 border-t border-gray-200 dark:border-gray-700"},ws={__name:"ChatApp",props:{isOpen:{type:Boolean,default:!0},with:{type:Object,default:()=>({})},isUser:{type:Boolean,default:!1}},emits:["update:isOpen"],setup(a,{emit:m}){const n=ve(),{user:h}=ye(n),l=a,V=m,t=S(null),p=S(null),x=S([]),w=S(""),C=S(!1),O=S(!1),r=S(1),s=S(1),u=S(!0),o=S(null),y=S(null),j=S(null),A=S(null),ie=()=>A.value?`private-conversation.${A.value}`:null,H=()=>{if(o.value){try{if(o.value.stopListening("MessageSent"),y.value&&le)try{le.leave(y.value)}catch{}}catch{}o.value=null,y.value=null}},se=()=>{if(H(),!le||!l.with?.id)return;const k=ie();k&&(y.value=k,o.value=le.private(k),o.value.listen(".MessageSent",$=>{const D=$.message??$;!D||!D.id||D.senderId!==h.value?.id&&(x.value.some(E=>E.id===D.id)||(x.value.push(D),K(()=>{g()&&b()})))}))},Z=async(k=1)=>{let $="";l.isUser?$=`/chat/conversations/get-messages/${l.with.id}?page=${k}`:$=`/chat/conversations/${l.with.conversation_id}/get-messages?page=${k}`,k===1?C.value=!0:O.value=!0;try{const D=await T.get($);if(D.status===200){const E=D.data;A.value=E.conversation_id??A.value;const L=E.messages,F=[...Array.isArray(L?.data)?L.data:[]].reverse();if(k===1)x.value=F,await K(),b();else{const R=p.value,Me=R?R.scrollHeight:0,Re=R?R.scrollTop:0;x.value.unshift(...F),await K(),R&&(R.scrollTop=R.scrollHeight-Me+Re)}r.value=L?.current_page??k,s.value=L?.last_page??k,E.current_user_id&&(j.value=E.current_user_id),A.value&&(H(),se())}}catch{}finally{C.value=!1,O.value=!1}},_=k=>{const $=k.target;$&&$.scrollTop<=10&&!O.value&&r.value<s.value&&Z(r.value+1)},g=()=>{const k=p.value;return k?k.scrollTop+k.clientHeight>=k.scrollHeight-150:!1},b=()=>{const k=p.value;k&&(k.scrollTop=k.scrollHeight)},q=async()=>{const k=w.value.trim();if(!k)return;const $=`tmp-${Date.now()}`,D=new Date().toISOString(),E={id:$,body:k,sender_id:h.value?.id,created_at:D,status:"sending"};x.value.push(E),w.value="",await K(),b();try{const L=await T.post(`/chat/messages/${A.value}`,{receiver_id:l.with.id,content:k});if(L.status===200){const z=L.data.message??L.data,F=x.value.findIndex(R=>R.id===$);F!==-1?x.value.splice(F,1,z):x.value.some(R=>R.id===z.id)||x.value.push(z),await K(),b()}}catch{const z=x.value.findIndex(F=>F.id===$);z!==-1&&(x.value[z].status="failed")}},Be=()=>{V("update:isOpen",!1),t.value&&(t.value.style.top="196px"),u.value=!0,H()},he=()=>{if(u.value){t.value&&(t.value.style.bottom="-21rem"),u.value=!1;return}t.value&&(t.value.style.bottom="1rem"),u.value=!0};return G(()=>l.isOpen,async k=>{if(k)await Z(1),se(),K(()=>{const $=p.value;$&&$.addEventListener("scroll",_)});else{const $=p.value;$&&$.removeEventListener("scroll",_),H()}}),Oe(()=>{const k=p.value;k&&k.removeEventListener("scroll",_),H()}),(k,$)=>a.isOpen?(d(),f("div",{key:0,class:"fixed bottom-4 right-9 bg-white dark:bg-gray-800 shadow-2xl z-50 rounded-lg w-80 transition-all",ref_key:"chatApp",ref:t},[e("div",ns,[e("div",os,[e("div",is,[e("div",ds,[e("span",null,v((l.with.name||"").split(" ").map(D=>D[0]).slice(0,2).join("").toUpperCase()),1)]),e("div",null,[e("span",us,[e("span",cs,v(l.with.name),1),l.with.is_trusty?(d(),f("span",ms,[i(c(ue),{class:"w-3 h-3 text-gray-600 dark:text-gray-300"})])):B("",!0)]),$[5]||($[5]=e("div",{class:"degree text-gray-600 dark:text-gray-400 text-[12px] font-medium mt-1"}," درجة الثقة 80% ",-1))])]),e("div",gs,[u.value?(d(),I(c(mt),{key:0,class:"h-[18px] w-[18px] cursor-pointer text-black dark:text-white hover:opacity-70",onClick:$[0]||($[0]=D=>he())})):(d(),I(c(ce),{key:1,class:"h-[18px] w-[18px] cursor-pointer text-black dark:text-white hover:opacity-70",onClick:$[1]||($[1]=D=>he())})),i(c(fe),{class:"h-[18px] w-[18px] cursor-pointer text-black dark:text-white hover:opacity-70",onClick:$[2]||($[2]=D=>Be())})])])]),e("div",{class:"content has-scroll p-5 h-64 overflow-y-auto scrollbar-hide",ref_key:"contentEl",ref:p},[C.value?(d(),f("div",ps," جاري التحميل... ")):B("",!0),(d(!0),f(N,null,te(x.value,D=>(d(),f(N,{key:D.id},[D.sender_id===c(h).id?(d(),f("div",fs,[e("p",xs,v(D.body),1),e("span",vs,v(D.created_at&&!isNaN(new Date(D.created_at))?new Date(D.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"الآن"),1)])):(d(),f("div",ys,[e("p",bs,v(D.body),1),e("span",hs,v(D.created_at&&!isNaN(new Date(D.created_at))?new Date(D.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"الآن"),1)]))],64))),128)),O.value?(d(),f("div",_s," تحميل أقدم الرسائل... ")):B("",!0)],512),e("div",ks,[Ve(e("input",{type:"text","onUpdate:modelValue":$[3]||($[3]=D=>w.value=D),onKeyup:$[4]||($[4]=Xe(D=>q(),["enter"])),placeholder:"اكتب رسالتك...",class:"focus:border-gray-500 focus:ring-gray-500 rounded-md bg-gray-100 dark:bg-gray-700 text-black dark:text-white block w-full placeholder:text-[14px] placeholder:font-normal placeholder:text-gray-500 dark:placeholder:text-gray-400"},null,544),[[Je,w.value]]),e("button",{onClick:q,class:P(["text-white rounded-lg w-14 h-10 inline-flex items-center justify-center transition",{"bg-black dark:bg-blue-600":w.value.length,"bg-gray-500 cursor-not-allowed":!w.value.length}])},[i(c(Ue),{class:"w-[22px] h-[22px] -rotate-[45deg]"})],2)])],512)):B("",!0)}},$s=pe(ws,[["__scopeId","data-v-f449bf49"]]),Cs=["onClick"],js={class:"image bg-blue-500 dark:bg-blue-700 text-white font-medium w-12 h-12 rounded-full flex items-center justify-center"},Ds={class:"flex flex-col gap-1"},Ss={class:"text-gray-900 dark:text-gray-100 font-normal"},Vs={class:"text-gray-500 dark:text-gray-400 text-[14px]"},Os={class:"self-end text-[12px] text-gray-400 dark:text-gray-500"},Us={key:0,class:"absolute left-4 top-1/2 -translate-y-1/2 -mt-2 bg-red-600 text-white text-sm rounded-full w-5 h-5 flex justify-center items-center"},qs={key:1,class:"text-gray-600 w-fit mx-auto mt-8 font-normal"},As={__name:"ChatSidebar",props:{modelValue:{type:Boolean,default:!1},numberOfUnRedChat:{type:Number,default:0}},emits:["update:modelValue","update:numberOfUnRedChat","chatWith"],setup(a,{emit:m}){const n=a,h=ve(),{user:l}=ye(h),{getRelativeTime:V}=Se(),t=M({get:()=>n.modelValue,set:r=>p("update:modelValue",r)}),p=m,x=S([]);G(t,async r=>{r?(document.body.style.overflow="hidden",await w()):document.body.style.overflow=""},{immediate:!0});const w=async()=>{try{const r=await T.get("/chat/conversations");r.status==200&&(x.value=r.data.conversations,p("update:numberOfUnRedChat",r.data.conversations_with_unread_count))}catch{}};ae(async()=>{await w()});const C=r=>r.user_one.id===l.value?.id?r.user_two.name:r.user_one.name,O=r=>{r.unread_count&&(p("update:numberOfUnRedChat",n.numberOfUnRedChat-1),r.unread_count=0),r.user_two.conversation_id=r.id,r.user_one.conversation_id=r.id,p("chatWith",r.user_one.id===l.value?.id?r.user_two:r.user_one)};return Oe(()=>{document.body.style.overflow=""}),(r,s)=>(d(),f(N,null,[e("div",{class:P(["scrollbar-hide overflow-auto h-screen fixed top-0 w-[400px] bg-white dark:bg-gray-900 shadow-lg transition-all duration-300 z-[1000000] pt-8",{"-right-full":!t.value,"right-0":t.value}])},[s[2]||(s[2]=e("div",{class:"text-center font-medium text-[24px] mb-4 text-blue-600 dark:text-blue-400"}," محادثاتك ",-1)),e("div",null,[x.value.length?(d(!0),f(N,{key:0},te(x.value,u=>(d(),f("div",{key:u.id,class:"flex items-center relative px-4 gap-4 last-of-type:border-none border-b border-gray-200 dark:border-gray-700 py-3 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",onClick:o=>O(u)},[e("div",js,v((C(u)||"").split(" ").map(o=>o[0]).slice(0,2).join("").toUpperCase()),1),e("div",Ds,[e("span",Ss,v(C(u)),1),e("span",Vs,v(u.last_message_sender_id===c(l).id?"أنت: ":"")+" "+v(u.last_message_body),1)]),s[1]||(s[1]=e("span",{class:"flex-1"},null,-1)),e("div",Os,[e("span",null,v(c(V)(u.last_message_date).replace("قبل","منذ")),1)]),u.unread_count>0?(d(),f("span",Us,v(u.unread_count),1)):B("",!0)],8,Cs))),128)):(d(),f("p",qs," لا يوجد لديك اي محادثات "))])],2),e("div",{class:P(["bg-black/30 fixed top-0 left-0 w-screen h-screen z-[900] transition-opacity",{hidden:!t.value}]),onClick:s[0]||(s[0]=u=>t.value=!1)},null,2)],64))}},Bs=pe(As,[["__scopeId","data-v-8f6d3812"]]),Ms={class:"min-h-screen"},Rs={class:"offers"},Ts={class:"flex justify-between items-center"},Is={key:0,class:"text-white bg-red-600 text-[9px] w-5 h-5 rounded-full absolute -top-[7px] -right-2 flex justify-center items-center text-center p-1 text-wrap"},Ns={class:"offers-list pb-8"},Ls={key:2,class:"text-gray-700 text-center text-sm mt-12 dark:text-gray-300"},Qs={__name:"ExchangeView",setup(a){const m=S(!1),n=oe("emitter"),h=S(0),l=W({isOpen:!1,with:{},is_user:!1}),V=_=>{l.isOpen=!0,l.with=_,l.is_user=!0},t=S(!1);G(()=>m.value,_=>{if(_){n.emit("hiddenButton",!0);return}n.emit("hiddenButton",!1)});const p=_=>{t.value=!1,l.isOpen=!0,l.with=_,l.is_user=!1},x=S(!1),w=W({dialog:!1,data:[]}),C=S([]),O=S({}),r=_=>{O.value=_,m.value=!0};G(()=>m.value,_=>{_||(O.value={})});const s=_=>{w.dialog=!0,w.data=_},u=async()=>{try{(await T.delete(`barters/${w.data}`)).status==200&&(n.emit("showNotificationAlert",["success","تم حذف العرض ينجاح!"]),C.value.data=C.value.data.filter(g=>g.id!==w.data))}catch{}},o=W({dialog:!1,data:{}}),y=_=>{o.dialog=!0,o.data=_},j=async()=>{try{(await T.post(`/barters/${o.data.id}/respond`)).status==200&&(n.emit("showNotificationAlert",["success","تم ارسال طلبك ينجاح!"]),await Z())}catch{}},A=W({dialog:!1,data:{}}),ie=_=>{A.dialog=!0,A.data=_},H=async()=>{try{(await T.post(`/barters/${A.data.barter_id}/respond/${A.data.id}`)).status==200&&(n.emit("showNotificationAlert",["success","تم قبول هذا المستخدم لعميلة التبادل!"]),await Z())}catch{}},se=async _=>{try{x.value=!0,(await T.put(`/barters/${_}/mark-as-completed`)).status==200&&(n.emit("showNotificationAlert",["success","تم انهاء هذه المقايضة بنجاح!"]),C.value.data=C.value.data.filter(b=>b.id!==_))}catch{}finally{x.value=!1}},Z=async()=>{try{x.value=!0;const _=await T.get("/barters");_.status==200&&(C.value=_.data.barters,Array.isArray(C.value?.data)&&C.value.data.sort((g,b)=>new Date(b.created_at)-new Date(g.created_at)))}catch{}finally{x.value=!1}};return ae(async()=>{await Z()}),(_,g)=>(d(),f("div",Ms,[i(et,null,{default:U(()=>[i(nt)]),_:1}),i(Te,{title:"لوحة المقايضة",subtitle:"تبادل السلع و الخدمات مع المجتمع"}),i(xe,{class:"mt-4 py-4 leading-none",label:"اعرض مقايضة جديدة",onClick:g[0]||(g[0]=b=>m.value=!0)},{icon:U(()=>[i(c(pt),{class:"h-5 w-5 stroke-2 ml-1"})]),_:1}),i($t,{class:"my-4",title:"تنبيه أمني",text:"تأكد من لقاء الاشخاص في اماكن امنة. وتحقق من هوية الشخص و درجة الثقة قبل التبادل"}),i(Rt,{"model-value":m.value,"onUpdate:modelValue":g[1]||(g[1]=b=>m.value=b),editData:O.value,onSuccess:Z},null,8,["model-value","editData"]),e("div",Rs,[e("div",Ts,[g[18]||(g[18]=e("h5",{class:"title font-medium text-[20px] text-black dark:text-white"}," العروض المتاحة ",-1)),e("div",{class:"message-icon relative left-4 cursor-pointer text-white bg-gray-600 flex items-center justify-center w-10 h-10 rounded-full font-bold",onClick:g[2]||(g[2]=b=>t.value=!0)},[e("button",null,[i(c(it),{class:"w-6"})]),h.value?(d(),f("span",Is,v(h.value),1)):B("",!0)])]),e("div",Ns,[x.value?(d(),f(N,{key:0},te(3,b=>e("div",{key:b,class:"single-offer p-4 bg-white dark:bg-gray-900 rounded-[10px] shadow-sm my-4 animate-pulse"},[...g[19]||(g[19]=[tt('<div class="flex items-center justify-between mb-4"><div class="info flex items-center gap-2"><div class="h-10 w-10 bg-gray-200 dark:bg-gray-700 rounded-full"></div><div class="space-y-2"><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded-lg w-32"></div><div class="h-3 bg-gray-200 dark:bg-gray-700 rounded-lg w-24"></div></div></div><div class="h-6 w-12 bg-red-200 dark:bg-red-900 rounded-md"></div></div><div class="flex items-center justify-center gap-4 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg"><div class="flex flex-col items-center space-y-2"><div class="h-3 bg-gray-200 dark:bg-gray-600 rounded-lg w-12"></div><div class="h-4 bg-gray-300 dark:bg-gray-500 rounded-lg w-20"></div></div><div class="h-5 w-5 bg-gray-300 dark:bg-gray-600 rounded"></div><div class="flex flex-col items-center space-y-2"><div class="h-3 bg-gray-200 dark:bg-gray-600 rounded-lg w-12"></div><div class="h-4 bg-gray-300 dark:bg-gray-500 rounded-lg w-20"></div></div></div><div class="mt-4 space-y-2"><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded-lg w-full"></div><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded-lg w-3/4"></div><div class="flex items-center justify-between mt-2"><div class="h-3 bg-gray-200 dark:bg-gray-700 rounded-lg w-24"></div><div class="h-3 bg-gray-200 dark:bg-gray-700 rounded-lg w-20"></div></div></div><div class="flex items-center gap-2 mt-4"><div class="flex-1 h-10 bg-gray-200 dark:bg-gray-700 rounded-lg"></div><div class="flex-1 h-10 bg-gray-200 dark:bg-gray-700 rounded-lg"></div></div>',4)])])),64)):C.value?.data?.length?(d(!0),f(N,{key:1},te(C.value.data,b=>(d(),I(ls,{key:b.id,item:b,onStartChat:g[3]||(g[3]=q=>V(q)),onDelete:g[4]||(g[4]=q=>s(q)),onEdit:g[5]||(g[5]=q=>r(q)),onSendAcceptResponse:g[6]||(g[6]=q=>y(q)),onAcceptUser:g[7]||(g[7]=q=>ie(q)),onMarkAsComplete:g[8]||(g[8]=q=>se(q))},null,8,["item"]))),128)):(d(),f("p",Ls," لا يوجد حتى الان اي عروض للمقايضة. قم باضافة عرضك الخاص بك "))])]),i($s,{"is-open":l.isOpen,"onUpdate:isOpen":g[9]||(g[9]=b=>l.isOpen=b),with:l.with,"onUpdate:with":g[10]||(g[10]=b=>l.with=b),"is-user":l.is_user,"onUpdate:isUser":g[11]||(g[11]=b=>l.is_user=b)},null,8,["is-open","with","is-user"]),i(Bs,{modelValue:t.value,"onUpdate:modelValue":g[12]||(g[12]=b=>t.value=b),onChatWith:g[13]||(g[13]=b=>p(b)),numberOfUnRedChat:h.value,"onUpdate:numberOfUnRedChat":g[14]||(g[14]=b=>h.value=b)},null,8,["modelValue","numberOfUnRedChat"]),i(de,{modelValue:w.dialog,"onUpdate:modelValue":g[15]||(g[15]=b=>w.dialog=b),title:"حدف العرض",message:"هل انت متأكد من حذف هذا العرض؟","button-label":"حذف العرض",onConfirm:u},null,8,["modelValue"]),i(de,{modelValue:o.dialog,"onUpdate:modelValue":g[16]||(g[16]=b=>o.dialog=b),title:"قبول عملة التبادل",message:"هل انت متأكد من ارسال طلب لقبول هذه المقايضة؟","button-label":"قبول",onConfirm:j},null,8,["modelValue"]),i(de,{modelValue:A.dialog,"onUpdate:modelValue":g[17]||(g[17]=b=>A.dialog=b),title:"الموافقة على عملية التبادل",message:"هل انت متأكد على ارسال رد الموافقة على عملية التبادل هذه؟ عند ارسال رد الموافقة لن تتمكن من تغيير الشخص.","button-label":"ارسال",onConfirm:H},null,8,["modelValue"])]))}};export{Qs as default};
